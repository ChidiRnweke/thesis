---
title: "RQ2"
output: html_document
---

```{r include= FALSE}
options(digits=7)
knitr::opts_chunk$set(echo=FALSE, message=FALSE)

```


```{r}
library(tidyverse)
library(kableExtra)

input = read_csv("RQ2_100_cleaned.csv")

```

```{r}
RQ1 <- input %>% 
  mutate(Drift = case_when(
    `Drift type` == "No Drift" ~ "No Drift",
    `Drift type` == "Sudden Shock" ~ "Shock",
    TRUE ~ "Drift"
  ))

```

# Global stats

## SMAPE table for drit vs no drift

```{r}
RQ1 %>% 
  filter(Drift != 'Shock', Algorithm=='Linear regression online') %>% 
  group_by(Drift) %>% 
  summarise(mean = mean(SMAPE), std =  sd(SMAPE), min = min(SMAPE), max = max(SMAPE), n = n()) %>%    kable() %>%    kable_styling()
```

## SMAPE table for drift types
```{r}
RQ1 %>% 
  filter(Drift != 'Shock', Algorithm=='Linear regression online') %>% 
  group_by(Drift, `Drift type`) %>% 
  summarise(mean = mean(SMAPE), std =  sd(SMAPE), min = min(SMAPE), max = max(SMAPE), n = n()) %>%    kable() %>%    kable_styling()
```



## T-test drift vs no drift
```{r}
LinearRegressionOnlineNoDrift <- RQ1 %>% 
  filter(Drift == 'No Drift', Algorithm=='Linear regression online')

LinearRegressionOnlineD <-  RQ1 %>% 
  filter(Drift == 'Drift', Algorithm=='Linear regression online')

t.test(LinearRegressionOnlineNoDrift$SMAPE, LinearRegressionOnlineD$SMAPE, var.equal = F, alternative = 'less')
  
  
```


  
```{r}
no_shock <- RQ1 %>% 
  filter(Drift!='Shock', Algorithm=='Linear regression online')


```

```{r}
inc_LinearRegressionOnline <- no_shock %>% 
  filter(`Drift type` =='Incremental Drift')

sudden_LinearRegressionOnline <- no_shock %>% 
  filter(`Drift type`=='Sudden Drift')
```

## T-test sudden vs no and incremental vs no
```{r}
t.test(sudden_LinearRegressionOnline$SMAPE, LinearRegressionOnlineNoDrift$SMAPE, var.equal = F, alternative='greater')

t.test(inc_LinearRegressionOnline$SMAPE, LinearRegressionOnlineNoDrift$SMAPE, var.equal = F, alternative='greater')
```
# Sudden drift

## T-tests for time
 
```{r}
sudden_LinearRegressionOnline_train <- sudden_LinearRegressionOnline %>% 
  filter(`Drift time`=="Training")

sudden_LinearRegressionOnline_traintest <- sudden_LinearRegressionOnline %>% 
  filter(`Drift time`=="Training/Test")

sudden_LinearRegressionOnline_test <- sudden_LinearRegressionOnline %>% 
  filter(`Drift time`=="Test")

t.test(sudden_LinearRegressionOnline_train$SMAPE, LinearRegressionOnlineNoDrift$SMAPE, var.equal = F, alternative='greater')
t.test(sudden_LinearRegressionOnline_traintest$SMAPE, LinearRegressionOnlineNoDrift$SMAPE, var.equal = F, alternative='greater')
t.test(sudden_LinearRegressionOnline_test$SMAPE, LinearRegressionOnlineNoDrift$SMAPE, var.equal = F, alternative='greater')

```

## SMAPE table for time
```{r}
RQ1 %>% 
  filter(Drift != 'Shock', Algorithm=='Linear regression online') %>% 
  group_by(Drift, `Drift type`, `Drift time`) %>% 
  summarise(mean = mean(SMAPE), std =  sd(SMAPE), min = min(SMAPE), max = max(SMAPE), n = n()) %>%    kable() %>%    kable_styling() 
```

## T-test for magnitude
```{r}
sudden_LinearRegressionOnline_small <- sudden_LinearRegressionOnline %>% 
  filter(`Drift magnitude`=='Small')

sudden_LinearRegressionOnline_large <- sudden_LinearRegressionOnline %>% 
  filter(`Drift magnitude`=='Large')

t.test(sudden_LinearRegressionOnline_small$SMAPE, LinearRegressionOnlineNoDrift$SMAPE, var.equal = F, alternative='greater')
t.test(sudden_LinearRegressionOnline_large$SMAPE, LinearRegressionOnlineNoDrift$SMAPE, var.equal = F, alternative='greater')
```

## SMAPE table for magnitude

```{r}
RQ1 %>% 
  filter(Drift != 'Shock', Algorithm=='Linear regression online') %>% 
  group_by(Drift, `Drift type`, `Drift magnitude`) %>% 
  summarise(mean = mean(SMAPE), std =  sd(SMAPE), min = min(SMAPE), max = max(SMAPE), n = n()) %>%    kable() %>%    kable_styling()

```


## T-tests for importance

```{r}
sudden_LinearRegressionOnline_important <- sudden_LinearRegressionOnline %>% 
  filter(`Variable importance`=="Important")

sudden_LinearRegressionOnline_medium <- sudden_LinearRegressionOnline %>% 
  filter(`Variable importance`=="Medium")

sudden_LinearRegressionOnline_unimportant <- sudden_LinearRegressionOnline %>% 
  filter(`Variable importance`=="Unimportant")

t.test(sudden_LinearRegressionOnline_important$SMAPE, LinearRegressionOnlineNoDrift$SMAPE, var.equal = F, alternative='greater')
t.test(sudden_LinearRegressionOnline_medium$SMAPE, LinearRegressionOnlineNoDrift$SMAPE, var.equal = F, alternative='greater')
t.test(sudden_LinearRegressionOnline_unimportant$SMAPE, LinearRegressionOnlineNoDrift$SMAPE, var.equal = F, alternative='greater')

```

## SMAPE table for importance

```{r}
RQ1 %>% 
  filter(Drift != 'Shock', Algorithm=='Linear regression online') %>% 
  group_by(Drift, `Drift type`, `Variable importance`) %>% 
  summarise(mean = mean(SMAPE), std =  sd(SMAPE), min = min(SMAPE), max = max(SMAPE), n = n()) %>%    kable() %>%    kable_styling()
```
 
## T-tests for dropping drifting and not drifting
 
```{r}
sudden_LinearRegressionOnline_driftingDropped <- sudden_LinearRegressionOnline %>% 
  filter(`Dropped drifting`=="TRUE")

sudden_LinearRegressionOnline_driftingNotDropped <- sudden_LinearRegressionOnline %>% 
  filter(`Dropped drifting`=="FALSE")

t.test(sudden_LinearRegressionOnline_driftingDropped$SMAPE, LinearRegressionOnlineNoDrift$SMAPE, var.equal = F, alternative='greater')
t.test(sudden_LinearRegressionOnline_driftingNotDropped$SMAPE, LinearRegressionOnlineNoDrift$SMAPE, var.equal = F, alternative='greater')


```

## SMAPE table for dropping drifting and not drifting

```{r}
RQ1 %>% 
  filter(Drift != 'Shock', Algorithm=='Linear regression online') %>% 
  group_by(Drift, `Drift type`,  `Dropped drifting`) %>% 
  summarise(mean = mean(SMAPE), std =  sd(SMAPE), min = min(SMAPE), max = max(SMAPE), n = n()) %>%    kable() %>%    kable_styling()

```
 
# Incremental

## T-tests for time
 
```{r}
inc_LinearRegressionOnline_train <- inc_LinearRegressionOnline %>% 
  filter(`Drift time`=="Training")

inc_LinearRegressionOnline_traintest <- inc_LinearRegressionOnline %>% 
  filter(`Drift time`=="Training/Test")

inc_LinearRegressionOnline_test <- inc_LinearRegressionOnline %>% 
  filter(`Drift time`=="Test")

t.test(inc_LinearRegressionOnline_train$SMAPE, LinearRegressionOnlineNoDrift$SMAPE, var.equal = F, alternative='greater')
t.test(inc_LinearRegressionOnline_traintest$SMAPE, LinearRegressionOnlineNoDrift$SMAPE, var.equal = F, alternative='greater')
  t.test(inc_LinearRegressionOnline_test$SMAPE, LinearRegressionOnlineNoDrift$SMAPE, var.equal = F, alternative='greater')

```

## T-tests for magnitude

```{r}
inc_LinearRegressionOnline_small <- inc_LinearRegressionOnline %>% 
  filter(`Drift magnitude`=='Small')

inc_LinearRegressionOnline_large <- inc_LinearRegressionOnline %>% 
  filter(`Drift magnitude`=='Large')

t.test(inc_LinearRegressionOnline_small$SMAPE, LinearRegressionOnlineNoDrift$SMAPE, var.equal = F, alternative='greater')
t.test(inc_LinearRegressionOnline_large$SMAPE, LinearRegressionOnlineNoDrift$SMAPE, var.equal = F, alternative='greater')
```

## T-tests for importance

```{r}
inc_LinearRegressionOnline_important <- inc_LinearRegressionOnline %>% 
  filter(`Variable importance`=="Important")

inc_LinearRegressionOnline_medium <- inc_LinearRegressionOnline %>% 
  filter(`Variable importance`=="Medium")

inc_LinearRegressionOnline_unimportant <- inc_LinearRegressionOnline %>% 
  filter(`Variable importance`=="Unimportant")

t.test(inc_LinearRegressionOnline_important$SMAPE, LinearRegressionOnlineNoDrift$SMAPE, var.equal = F, alternative='greater')
t.test(inc_LinearRegressionOnline_medium$SMAPE, LinearRegressionOnlineNoDrift$SMAPE, var.equal = F, alternative='greater')
t.test(inc_LinearRegressionOnline_unimportant$SMAPE, LinearRegressionOnlineNoDrift$SMAPE, var.equal = F, alternative='greater')

```
 
## T-tests for dropping drifting and not drifting

```{r}
inc_LinearRegressionOnline_driftingDropped <- inc_LinearRegressionOnline %>% 
  filter(`Dropped drifting`=="TRUE")

inc_LinearRegressionOnline_driftingNotDropped <- inc_LinearRegressionOnline %>% 
  filter(`Dropped drifting`=="FALSE")

t.test(inc_LinearRegressionOnline_driftingDropped$SMAPE, LinearRegressionOnlineNoDrift$SMAPE, var.equal = F, alternative='greater')
t.test(inc_LinearRegressionOnline_driftingNotDropped$SMAPE, LinearRegressionOnlineNoDrift$SMAPE, var.equal = F, alternative='greater')



```

